package Calculator;

import java.awt.EventQueue;
import javax.swing.JFrame;
import javax.swing.JTextField;
import javax.swing.JButton;
import javax.swing.JTextArea;
import javax.swing.JScrollPane;
import javax.swing.JLabel;
import java.awt.Font;
import java.awt.Color;
import javax.swing.SwingConstants;
import javax.swing.border.LineBorder;
import java.util.ArrayList;
import java.util.List;

public class Calculator {

	private JFrame CALCULATOR;
	private JTextField textField;
	private JTextArea historyArea;
	
	Color colorBackground = new Color(45, 27, 54);
	Color colorButton = new Color(162, 136, 227);
	Color colorOperators = new Color(110, 68, 255);
	Color colorEqual = new Color(187, 134, 252);
	Color colorText = Color.WHITE;

	public static void main(String[] args) {
		EventQueue.invokeLater(() -> {
			try {
				Calculator window = new Calculator();
				window.CALCULATOR.setVisible(true);
			} catch (Exception e) {
				e.printStackTrace();
			}
		});
	}

	public Calculator() {
		initialize();
	}

	private void initialize() {
		CALCULATOR = new JFrame();
		CALCULATOR.setTitle("Calculator de Expresii Matematice");
		CALCULATOR.getContentPane().setBackground(colorBackground);
		CALCULATOR.setBounds(100, 100, 620, 600);
		CALCULATOR.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		CALCULATOR.getContentPane().setLayout(null);
		
		textField = new JTextField();
		textField.setHorizontalAlignment(SwingConstants.RIGHT);
		textField.setBackground(new Color(60, 40, 75));
		textField.setForeground(colorText);
		textField.setBorder(new LineBorder(colorOperators, 2));
		textField.setFont(new Font("Segoe UI", Font.BOLD, 28));
		textField.setBounds(15, 25, 335, 90);
		CALCULATOR.getContentPane().add(textField);

		
		JLabel lblHistory = new JLabel("ISTORIC");
		lblHistory.setForeground(colorEqual);
		lblHistory.setFont(new Font("Segoe UI", Font.BOLD, 14));
		lblHistory.setBounds(370, 10, 100, 20);
		CALCULATOR.getContentPane().add(lblHistory);

		historyArea = new JTextArea();
		historyArea.setEditable(false);
		historyArea.setBackground(new Color(35, 20, 45));
		historyArea.setForeground(new Color(200, 180, 220));
		historyArea.setFont(new Font("Monospaced", Font.PLAIN, 14));
		
		JScrollPane scrollPane = new JScrollPane(historyArea);
		scrollPane.setBounds(370, 35, 210, 480);
		scrollPane.setBorder(new LineBorder(colorOperators, 1));
		CALCULATOR.getContentPane().add(scrollPane);

		JButton btnClearHistory = new JButton("Șterge Istoric");
		btnClearHistory.setBounds(370, 520, 210, 25);
		btnClearHistory.setBackground(colorBackground);
		btnClearHistory.setForeground(colorButton);
		btnClearHistory.setFocusPainted(false);
		btnClearHistory.setBorder(new LineBorder(colorButton));
		btnClearHistory.addActionListener(e -> historyArea.setText(""));
		CALCULATOR.getContentPane().add(btnClearHistory);
		
		
		JButton btnClear = createStyledButton("C", 15, 130, colorOperators);
		btnClear.addActionListener(e -> textField.setText(""));
		CALCULATOR.getContentPane().add(btnClear);

		JButton btnBack = createStyledButton("←", 100, 130, colorOperators);
		btnBack.addActionListener(e -> {
			String currentText = textField.getText();
			if(currentText.length() > 0) {
				if(currentText.endsWith(" "))
					textField.setText(currentText.substring(0, currentText.length() - 3));
				else
					textField.setText(currentText.substring(0, currentText.length() - 1));
			}
		});
		CALCULATOR.getContentPane().add(btnBack);

		JButton btn00 = createStyledButton("00", 185, 130, colorOperators);
		btn00.addActionListener(e -> textField.setText(textField.getText() + "00"));
		CALCULATOR.getContentPane().add(btn00);

		JButton btnPlus = createStyledButton("+", 270, 130, colorOperators);
		btnPlus.addActionListener(e -> addOperator(" + "));
		CALCULATOR.getContentPane().add(btnPlus);

		addNumberButton("7", 15, 210);
		addNumberButton("8", 100, 210);
		addNumberButton("9", 185, 210);
		
		JButton btnMinus = createStyledButton("-", 270, 210, colorOperators);
		btnMinus.addActionListener(e -> addOperator(" - "));
		CALCULATOR.getContentPane().add(btnMinus);

		addNumberButton("4", 15, 290);
		addNumberButton("5", 100, 290);
		addNumberButton("6", 185, 290);
		
		JButton btnMul = createStyledButton("*", 270, 290, colorOperators);
		btnMul.addActionListener(e -> addOperator(" * "));
		CALCULATOR.getContentPane().add(btnMul);

		addNumberButton("1", 15, 370);
		addNumberButton("2", 100, 370);
		addNumberButton("3", 185, 370);
		
		JButton btnDiv = createStyledButton("/", 270, 370, colorOperators);
		btnDiv.addActionListener(e -> addOperator(" / "));
		CALCULATOR.getContentPane().add(btnDiv);

		addNumberButton("0", 15, 450);
		
		JButton btnDot = createStyledButton(".", 100, 450, colorButton);
		btnDot.addActionListener(e -> {
			if(!textField.getText().endsWith(".")) textField.setText(textField.getText() + ".");
		});
		CALCULATOR.getContentPane().add(btnDot);

		JButton btnEgal = createStyledButton("=", 185, 450, colorEqual);
		btnEgal.setForeground(colorBackground);
		btnEgal.addActionListener(e -> calculateResult());
		CALCULATOR.getContentPane().add(btnEgal);

		JButton btnPercent = createStyledButton("%", 270, 450, colorOperators);
		btnPercent.addActionListener(e -> addOperator(" % "));
		CALCULATOR.getContentPane().add(btnPercent);
	}

	private void addOperator(String op) {
		String text = textField.getText();
		if(!text.isEmpty() && !text.endsWith(" ")) {
			textField.setText(text + op);
		}
	}

	private void calculateResult() {
		try {
			String originalInput = textField.getText();
			String[] parts = originalInput.split(" ");
			if (parts.length < 3) return;

			List<Double> numbers = new ArrayList<>();
			List<String> ops = new ArrayList<>();

			for (int i = 0; i < parts.length; i++) {
				if (i % 2 == 0) numbers.add(Double.parseDouble(parts[i]));
				else ops.add(parts[i]);
			}

			
			for (int i = 0; i < ops.size(); i++) {
				String op = ops.get(i);
				if (op.equals("*") || op.equals("/") || op.equals("%")) {
					double res = 0;
					if (op.equals("*")) res = numbers.get(i) * numbers.get(i + 1);
					else if (op.equals("/")) res = numbers.get(i) / numbers.get(i + 1);
					else if (op.equals("%")) res = numbers.get(i) % numbers.get(i + 1);
					
					numbers.set(i, res);
					numbers.remove(i + 1);
					ops.remove(i);
					i--;
				}
			}

			double finalRes = numbers.get(0);
			for (int i = 0; i < ops.size(); i++) {
				String op = ops.get(i);
				if (op.equals("+")) finalRes += numbers.get(i + 1);
				else if (op.equals("-")) finalRes -= numbers.get(i + 1);
			}

			String finalOutput;
			if (finalRes == (long) finalRes) finalOutput = String.format("%d", (long)finalRes);
			else finalOutput = String.valueOf(finalRes);

			
			historyArea.append(originalInput + " = " + finalOutput + "\n------------------\n");
			textField.setText(finalOutput);

		} catch (Exception ex) {
			textField.setText("Error");
		}
	}

	private void addNumberButton(String label, int x, int y) {
		JButton btn = createStyledButton(label, x, y, colorButton);
		btn.addActionListener(e -> textField.setText(textField.getText() + label));
		CALCULATOR.getContentPane().add(btn);
	}

	private JButton createStyledButton(String text, int x, int y, Color bg) {
		JButton btn = new JButton(text);
		btn.setFont(new Font("Segoe UI", Font.BOLD, 18));
		btn.setBounds(x, y, 75, 65);
		btn.setBackground(bg);
		btn.setForeground(Color.WHITE);
		btn.setFocusPainted(false);
		btn.setBorder(null);
		return btn;
	}
