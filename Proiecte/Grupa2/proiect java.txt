import java.io.*;
import java.util.*;

// 1. CLASA PENTRU O POSTARE
class Postare {
    String autor;
    String text;
    int likeuri;

    public Postare(String autor, String text) {
        this.autor = autor;
        this.text = text;
        this.likeuri = 0;
    }

    public void daLike() {
        this.likeuri++;
    }

    @Override
    public String toString() {
        return "@" + autor + ": " + text + " [Likes: " + likeuri + "]";
    }
    
    // Format pentru salvare in fisier 
    public String toFileString() {
        return autor + ";" + text + ";" + likeuri;
    }
}

// 2. CLASA PENTRU UTILIZATOR
class Utilizator {
    String nume;
    ArrayList<String> prieteni; // Lista cu numele prietenilor

    public Utilizator(String nume) {
        this.nume = nume;
        this.prieteni = new ArrayList<>();
    }

    public void adaugaPrieten(String numePrieten) {
        if (!prieteni.contains(numePrieten) && !numePrieten.equals(this.nume)) {
            prieteni.add(numePrieten);
            System.out.println("Te-ai imprietenit cu " + numePrieten + "!");
        } else {
            System.out.println("Esti deja prieten sau nu te poti adauga pe tine.");
        }
    }
}

// 3. CLASA PRINCIPALA (MAIN)
public class SocialApp {
    
    // "Baza de date" in memorie
    static ArrayList<Utilizator> utilizatori = new ArrayList<>();
    static ArrayList<Postare> toatePostarile = new ArrayList<>();
    static Utilizator utilizatorCurent = null; // Cine este logat acum?
    static Scanner scanner = new Scanner(System.in);
    static final String FISIER_DATE = "social_data.txt";

    public static void main(String[] args) {
        incarcareDate(); // Incarcam postarile vechi daca exista
        
        int optiune;
        do {
            System.out.println("\n=== SOCIAL CONSOLE ===");
            if (utilizatorCurent == null) {
                System.out.println("1. Inregistrare / Login");
                System.out.println("0. Iesire");
                System.out.print("Alege: ");
                optiune = scanner.nextInt(); scanner.nextLine();
                
                if (optiune == 1) loginSauRegister();
                
            } else {
                System.out.println("Salut, " + utilizatorCurent.nume + "!");
                System.out.println("1. Scrie o Postare");
                System.out.println("2. Vezi Feed (Noutati)");
                System.out.println("3. Adauga un Prieten");
                System.out.println("4. Vezi lista mea de prieteni");
                System.out.println("5. Deconectare (Logout)");
                System.out.println("0. Iesire din aplicatie");
                System.out.print("Alege: ");
                optiune = scanner.nextInt(); scanner.nextLine();

                switch (optiune) {
                    case 1: scriePostare(); break;
                    case 2: afisareFeed(); break;
                    case 3: adaugaPrieten(); break;
                    case 4: afisarePrieteni(); break;
                    case 5: 
                        utilizatorCurent = null; 
                        System.out.println("Te-ai deconectat.");
                        break;
                    case 0: 
                        salvareDate();
                        System.out.println("La revedere!");
                        break;
                    default: System.out.println("Optiune invalida.");
                }
            }
        } while (optiune != 0 || utilizatorCurent != null); // Ramane in bucla daca dai logout
        
        // Salvare finala la inchidere
        salvareDate();
    }

    //  METODELE FUNCTIONALE 

    private static void loginSauRegister() {
        System.out.print("Introdu numele tau de utilizator: ");
        String nume = scanner.nextLine().trim();
        
        // Cautam daca exista deja
        for (Utilizator u : utilizatori) {
            if (u.nume.equalsIgnoreCase(nume)) {
                utilizatorCurent = u;
                System.out.println("Bine ai revenit, " + nume + "!");
                return;
            }
        }
        
        // Daca nu exista, il cream
        Utilizator nou = new Utilizator(nume);
        utilizatori.add(nou);
        utilizatorCurent = nou;
        System.out.println("Cont nou creat pentru " + nume + "!");
    }

    private static void scriePostare() {
        System.out.print("Ce ai in minte?: ");
        String text = scanner.nextLine();
        Postare p = new Postare(utilizatorCurent.nume, text);
        toatePostarile.add(p);
        System.out.println("Postat cu succes!");
    }

    private static void afisareFeed() {
        System.out.println("\n--- NEWS FEED ---");
        boolean gol = true;
        // Afisam postarile mele SI ale prietenilor
        for (Postare p : toatePostarile) {
            if (p.autor.equals(utilizatorCurent.nume) || utilizatorCurent.prieteni.contains(p.autor)) {
                System.out.println(p); // Apeleaza automat toString()
                gol = false;
            }
        }
        if (gol) System.out.println("Nimic nou. Adauga prieteni sau scrie ceva!");
    }

    private static void adaugaPrieten() {
        System.out.print("Pe cine vrei sa adaugi (nume exacte): ");
        String numePrieten = scanner.nextLine();
        utilizatorCurent.adaugaPrieten(numePrieten);
    }
    
    private static void afisarePrieteni() {
        System.out.println("Prietenii tai: " + utilizatorCurent.prieteni);
    }

    //  SALVARE SI INCARCARE (Persistence) 
    
    private static void salvareDate() {
        try (BufferedWriter bw = new BufferedWriter(new FileWriter(FISIER_DATE))) {
            for (Postare p : toatePostarile) {
                bw.write(p.toFileString());
                bw.newLine();
            }
            
            // Aici salvam doar postarile pentru simplitate
        } catch (IOException e) {
            System.out.println("Eroare la salvare.");
        }
    }

    private static void incarcareDate() {
        File f = new File(FISIER_DATE);
        if (!f.exists()) return;

        try (BufferedReader br = new BufferedReader(new FileReader(f))) {
            String linie;
            while ((linie = br.readLine()) != null) {
                String[] parti = linie.split(";");
                if (parti.length == 3) {
                    Postare p = new Postare(parti[0], parti[1]);
                    p.likeuri = Integer.parseInt(parti[2]);
                    toatePostarile.add(p);
                    
                    // Reconstituim userii din postari 
                    boolean existaUser = false;
                    for(Utilizator u : utilizatori) {
                        if(u.nume.equals(parti[0])) existaUser = true;
                    }
                    if(!existaUser) utilizatori.add(new Utilizator(parti[0]));
                }
            }
        } catch (Exception e) {
            System.out.println("Eroare la incarcare.");
        }
    }
}
 
